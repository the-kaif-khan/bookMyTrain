<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Query house user bayana forms page</title>

      <link rel="stylesheet" href="/stylesheets/sellingPagesCSS/landbooker-selling-form-page-body.css">
      <link rel="stylesheet" href="/stylesheets/sellingPagesCSS/landbooker-selling-form-page-footer.css">
      <link rel="stylesheet" href="/stylesheets/sellingPagesCSS/landbooker-selling-form-page-header.css">
      <link rel="stylesheet" href="/stylesheets/sellingPagesCSS/landbooker-selling-form-page-products.css">
      <link rel="stylesheet" href="/stylesheets/sellingPagesCSS/landbooker-selling-form-page-sidebar.css">

</head>
<body>
      <!-- header container -->
  <!-- header -->
  <div class="cartHeading">
    <div class="cartHeadingLogo">
      <a href="/home/landbook">
        <img src="/imagesAndVideos/Logos/LOGO/Wow3.png" alt="">
      </a> 
    </div>
    <div class="cartHeadingText">
        Landbooker Users bayana forms (
      <span class="cartNumber js-cartNumber">
        <%= queryhouseUserBayanaForms.length %>
      </span>
      Items) 
    </div>
  </div>

  <!-- navigations -->
  <div class="navigationsBox">
    <% if(landbookers) { %>
      <a href="/landbook-query-house/franchise/owner/login/<%= franchise.slug %>" class="links">
        <div class="navLinks">
          Home
        </div>       
      </a>
    <% } else { %>
      <a href="/landbook-query-house/franchise/owner/<%= franchise.slug %>" class="links">
        <div class="navLinks">
          Home
        </div>       
      </a>
    <% } %>
    <% if(landbookers) { %>
      <a href="/landbook-query-house/query-house-owner-panel/<%= franchise.slug %>" class="links">
        <div class="navLinks">
          Previous page
        </div>
      </a>
    <% } else { %>
      <a href="/landbook-query-house/query-house-panel/<%= franchise.slug %>" class="links">
        <div class="navLinks">
          Previous page
        </div>
      </a>
    <% } %>
    <!-- <div class="navlinksOfCart">
      <a href="/us/createProductsPanel" class="buying">
        <div class="textBuyingCart">Create new product</div> <img src="/imagesAndVideos/Logos/Cart Icon.svg" alt="" class="buyingNowCartLink">
      </a>
      <div class="buyingNowCartNotification">
        0
      </div>
    </div> -->
  </div>

  <% if(success.length > 0) { %>
    <div class="flash flash-success">
      <%= success %>
    </div>
  <% } %>
  <% if(error.length > 0) { %>
    <div class="flash flash-error">
      <%= error %>
    </div>
  <% } %>

    <!-- product lists in this container through javascript -->
    <div class="container">
      <% if(queryhouseUserBayanaForms.length > 0) { %>
        <% queryhouseUserBayanaForms.forEach((bCartTimers) => { %>
          <div class = "productsContainer">
              <div id = "<%= bCartTimers._id %>">
                <!-- <div class="productsImage">
                  <img src= "" alt="Timing to add product here">
                </div> -->

                <!-- timer placeholder -->
                
                <!-- <div class="timer-container">
                  <div class="timer" data-createdat="<%= bCartTimers.createdAt %>" data-formid="<%= bCartTimers._id %>">
                    Loading...
                  </div>
                  <div class="progress-bar">
                    <div class="progress"></div>
                  </div>
                </div> -->

                <div class="userDetails">
                  <div class="details">
                    Buyer Priority : <b><%= bCartTimers.priority %></b>
                  </div>
                  <div class="details">
                    Buyer Name: <b><%= bCartTimers.user[0].name %></b>
                  </div>
                  <div class="details">
                    Buyer username: <b><%= bCartTimers.user[0].username %></b>
                  </div>
                  <div class="details">
                    Buyer email: <b><%= bCartTimers.user[0].email %></b>
                  </div>
                  <div class="details">
                    Buyer current Contact Number: <b><%= bCartTimers.currentContact %></b>
                  </div>
                  <div class="details">
                    Buyer Contact Number: <b><%= bCartTimers.user[0].contactNumber %></b>
                  </div>
                </div>

                <div class="sellerDetails">
                  <div class="details">
                    Seller Name: <b><%= bCartTimers.productSeller[0].name %></b>
                  </div>
                  <div class="details">
                    Seller username: <b><%= bCartTimers.productSeller[0].username %></b>
                  </div>
                  <div class="details">
                    Seller email: <b><%= bCartTimers.productSeller[0].email %></b>
                  </div>
                  <div class="details">
                    Seller Contact Number: <b><%= bCartTimers.productSeller[0].contactNumber %></b>
                  </div>
                </div>

                <% if(bCartTimers.buyingFormId.length > 0 && !bCartTimers.bayana) { %>
                  <div class="timerTitle">
                    Time left for claimed people to give Bayana to this land
                  </div>
                  <div class="timer-container">
                    <div class="timer" data-createdat="<%= bCartTimers.buyingFormId[0].createdAt %>" data-bayanaformid="<%= bCartTimers._id %>" data-formid="<%= bCartTimers.buyingFormId[0]._id %>">
                      Loading...
                    </div>
                    <div class="progress-bar">
                      <div class="progress"></div>
                    </div>
                  </div>
                <% } %>

                <% if(bCartTimers.buyingCartTimerId.length > 0 && !bCartTimers.bayana) { %>
                  <div class="timerTitle">
                    Time left for Buying person to give Bayana to this land
                  </div>
                  <div class="timer-container">
                    <div class="buyingCartTimer" data-createdat="<%= bCartTimers.buyingCartTimerId[0].createdAt %>" data-buyingcarttimerid="<%= bCartTimers._id %>" data-buyingcarttimerid="<%= bCartTimers.buyingCartTimerId[0]._id %>">
                      Loading...
                    </div>
                    <div class="progress-bar">
                      <div class="buyingCartProgress"></div>
                    </div>
                  </div>
                <% } %>
                
                <% if (bCartTimers.productId.length > 0) { %>
                  <% bCartTimers.productId.forEach(product => { %>
            <a href="/landbook-query-house/queryhouse-calculated-price/<%= product._id %>/<%= franchise.slug %>" class="productLink">
                  <div class="fullInsideProduct">
                    <div class="productsPriceAndLB">
                      <div class= "productsPrice">
                        Click here see Landbook Pricing of this product.
                      </div>
                      <div class= "productsLB">
                        <b>Note: </b> This timers page only contains minute product details, if you wanna view full productDetails then you can view buying cart products in your profile page with detailed price and nearly everything about the product... Landbook
                      </div>
                    </div>
                    <div class="productsSpec">
                      Price: <%= product.landbookPrice %> Lakhs &#183
                    </div>

                    <div class="productsStats">
                      <div class="productsVisit">
                        LB: <%= product.LB %> &#183
                      </div>
                      <div class="productsRating">
                        <img src= "">
                      </div>
                      <div class="productsClaim">
                          Visits: <%= product.visits.length %> &#183
                      </div>
                    </div>
                    <% if(!bCartTimers.bayana) { %>
                      <div class="note">
                        <b>Note</b>: Bayana form cannot be filled twice.
                      </div>
                      <form action="/landbook-query-house/fill-bayana-by-query-house/<%= bCartTimers._id %>" method="post" enctype="multipart/form-data">
                        <div class="bayanaFormTitle">
                          Fill bayana image here
                        </div>
                        <input type="file" name="bayana" placeholder="Enter the bayana image of this user" class="inputs" required>
                        <input type="submit" class="submit-button">
                      </form>
                    <% } else { %>
                      <div class="green">
                        Bayana form filled successfully. Bayana form cannot be filled twice!
                      </div>
                    <% } %>
                    <% if(landbookers) { %>
                      <a href="/landad/delete-user-bayana-form/<%= bCartTimers._id %>" class="deletionLink"> Delete this bayana form</a>
                    <% } %>
                  </div>
                <% }) %>
                <% } else { %>
                  <div>No product info found.</div>
                <% } %>
            </a>
                <!-- <a href="/us/user/remove-buying-cart-timer/<%= bCartTimers._id %>" class="links">
                  <button type="submit" class="claimToCartButton" onclick="return confirmDeleteForm()">
                    Remove product
                  </button>
                </a> -->
              </div>
            
          </div>
        <% }) %>
      <% } else{ %>
        <div class="noProducts">no timers for your buying cart available, which means you don't have any product in your buying cart. You can check in your profile's buying cart products...and try again later. <span class="highlights">Landbook</span></div>
      <% } %>
    </div>


  <!-- footer container -->
  <footer>

    <div class="aboutThisPage">
      <div class="aboutThisPageLanguage">
        <div class="languageImage">
          <img src="/imagesAndVideos/Logos/About us icon.svg" alt="">
        </div>
        <div class="languageText">
          English
        </div>  
      </div>

      <div class="aboutCountry">
        <div class="aboutCountryImage">
          <img src="/imagesAndVideos/Logos/LOGO/Wow4.webp" alt="">
        </div>
        <div class="aboutCountryText">
          India
        </div>
      </div>
    </div>

    <div class="aboutCompany">
      <div class="companyConditions aboutCompanyTexts">
        Conditions of Use
      </div>
      <div class="companyPrivacyPolicy aboutCompanyTexts">
        Privacy Notice
      </div>
      <div class="aboutAdvertising aboutCompanyTexts">
        Interest-Based Ads
      </div>
    </div>

    <div class="companyCopywrite">
      .c. 1996-2024, Landbook.com, Inc. and its affiliates
    </div>

  </footer>

    

  <script src="/javascripts/queryhouse-user-bayana-timers.js"></script>

  <!-- <script>
    // for timer... scripts starts here
    const timers = document.querySelectorAll('.timer');
    timers.forEach(timer => {
      const createdAt = new Date(timer.dataset.createdat);
      const endTime = new Date(createdAt.getTime() + 4 * 60 * 1000);
      const formId = timer.dataset.formid;
      const bayanaformid = timer.dataset.bayanaformid;
      const progressBar = timer.nextElementSibling.querySelector('.progress');

      function updateTimer() {
        const now = new Date();
        const diff = endTime - now;
        const total = 4 * 60 * 1000;
        if(diff <= 0) {
          timer.textContent = 'Time Over';
          timer.classList.add('over');
          progressBar.style.width = '0%';
          // move automatically
          fetch(`/landbook-query-house/admin/deleting-bayana-forms/${bayanaformid}`, {
            method: 'POST'
          }).then(res => {
            if(res.ok) {
              console.log('Product moved to buying cart automatically!');
              location.reload();
            }
          });
        } else {
          const hours = Math.floor(diff / (1000 * 60 * 60));
          const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((diff % (1000 * 60)) / 1000);
          timer.textContent = `${hours}hr ${minutes}min ${seconds}sec`;
          // update progress bar
          const percentage = (diff / total) * 100;
          progressBar.style.width = `${percentage}`;
        }
      }
      setInterval(updateTimer, 1000);
      updateTimer();
    })

    // for buying cart timer people... for user-buying-cart-timers-page and queryhouse-user-bayana-forms page scripts starts here
    const buyingCartTimers = document.querySelectorAll('.buyingCartTimer');
    buyingCartTimers.forEach(timer => {
      const createdAt = new Date(timer.dataset.createdat);
      const endTime = new Date(createdAt.getTime() + 5 * 60 * 1000);
      const buyingCartTimerId = timer.dataset.buyingcarttimerid;
      const progressBar = timer.nextElementSibling.querySelector('.buyingCartProgress');

      function updateTimer() {
        const now = new Date();
        const diff = endTime - now;
        const total = 5 * 60 * 1000;
        if(diff <= 0) {
          timer.textContent = 'Time Over';
          timer.classList.add('over');
          progressBar.style.width = '0%';
          // move automatically
          fetch(`/home/admin/modify-buying-products/${buyingCartTimerId}`, {
            method: 'POST'
          }).then(res => {
            if(res.ok) {
              console.log('Product moved to buying cart automatically!');
              location.reload();
            }
          });
        } else {
          const hours = Math.floor(diff / (1000 * 60 * 60));
          const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((diff % (1000 * 60)) / 1000);
          timer.textContent = `${hours}hr ${minutes}min ${seconds}sec`;
          // update progress bar
          const percentage = (diff / total) * 100;
          progressBar.style.width = `${percentage}`;
        }
      }
      setInterval(updateTimer, 1000);
      updateTimer();
    })
    // for buying cart timer people timer ends here
  </script> -->


</body>
</html>