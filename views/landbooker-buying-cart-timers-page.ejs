<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>andbooker user buying cart timers page</title>

      <link rel="stylesheet" href="/stylesheets/sellingPagesCSS/landbooker-selling-form-page-body.css">
      <link rel="stylesheet" href="/stylesheets/sellingPagesCSS/landbooker-selling-form-page-footer.css">
      <link rel="stylesheet" href="/stylesheets/sellingPagesCSS/landbooker-selling-form-page-header.css">
      <link rel="stylesheet" href="/stylesheets/sellingPagesCSS/landbooker-selling-form-page-products.css">
      <link rel="stylesheet" href="/stylesheets/sellingPagesCSS/landbooker-selling-form-page-sidebar.css">

</head>
<body>
      <!-- header container -->
  <!-- header -->
  <div class="cartHeading">
    <div class="cartHeadingLogo">
      <a href="the-page-of-selling.html">
        <img src="/imagesAndVideos/Logos/LOGO/Wow3.png" alt="">
      </a> 
    </div>
    <div class="cartHeadingText">
        Buying cart timers (
      <span class="cartNumber js-cartNumber">
        <%= buyingCartTimers.length %>
      </span>
      Items) 
    </div>
  </div>

  <!-- navigations -->
  <div class="navigationsBox">
    <a href="/us/landbook" class="links">
      <div class="navLinks">
        Home
      </div>       
    </a>

    <a href="/us/createProductsPanel" class="links">
      <div class="navLinks">
        Previous page
      </div>
    </a>

    <div class="navlinksOfCart">
      <a href="/us/createProductsPanel" class="buying">
        <div class="textBuyingCart">Create new product</div> <img src="/imagesAndVideos/Logos/Cart Icon.svg" alt="" class="buyingNowCartLink">
      </a>
      <div class="buyingNowCartNotification">
        0
      </div>
    </div>

  </div>

  <!-- sidebar container -->
  <div class="sidebarContainer">
    <a href="/us/buyingforms" class="sidebarLinks">
      <div class="advertisingSidebar sidebarContents">
        <img src="/imagesAndVideos/Logos/LOGO/Wow4.webp" alt="">
        Buying forms
      </div>
    </a>
    <a href="/us/Sellingforms" class="sidebarLinks">
      <div class="cartIconSidebar sidebarContents">
        <img src="/imagesAndVideos/Logos/Cart Icon.svg" alt="">
        SellingForms
      </div>
    </a>  
    <a href="/home/buyingCartTimersPage" class="sidebarLinks">
      <div class="helpIcon sidebarContents">
        <img src="/imagesAndVideos/Logos/Help icon.svg" alt="">
          Buying cart timers
      </div>
    </a>

    <a href="/home/mapCoordinates" class="sidebarLinks">
      <div class="supportUsIcon sidebarContents">
        <img src="/imagesAndVideos/Logos/User feedback icon.svg" alt="">
        Get map coordinates
      </div>
    </a>

    <a href="/home/aboutus" class="sidebarLinks">
      <div class="aboutUsIcon sidebarContents">
        <img src="/imagesAndVideos/Logos/About us icon.svg" alt="">
        About Us
      </div>
    </a>


  </div>

  <% if(success.length > 0) { %>
    <div class="flash flash-success">
      <%= success %>
    </div>
  <% } %>
  <% if(error.length > 0) { %>
    <div class="flash flash-error">
      <%= error %>
    </div>
  <% } %>

    <!-- product lists in this container through javascript -->
    <div class="container">
      <% if(buyingCartTimers.length > 0) { %>
        <% buyingCartTimers.forEach((buyingCartTimer) => { %>
          <div class = "productsContainer">
            <a href="" class="productLink">
              <div id = "<%= buyingCartTimer._id %>">
                <!-- <div class="productsImage">
                  <img src= "" alt="Timing to add product here">
                </div> -->

                <!-- timer placeholder -->
                
                <div class="timer-container">
                  <div class="timer" data-createdat="<%= buyingCartTimer.createdAt %>" data-formid="<%= buyingCartTimer._id %>">
                    Loading...
                  </div>
                  <div class="progress-bar">
                    <div class="progress"></div>
                  </div>
                </div>

                <div class="productsPriceAndLB">
                  <div class= "productsPrice">
                    User: <%= buyingCartTimer.user %>
                  </div>
                  <div class= "productsLB">
                    Product: <%= buyingCartTimer.product %>
                  </div>
                </div>
                <div class="productsSpec">
                  &#183
                </div>
                <div class="productsStats">
                  <div class="productsVisit">
                    &#183
                  </div>
                  <div class="productsRating">
                    <img src= "">
                  </div>
                  <div class="productsClaim">
                     &#183
                  </div>
                </div>
            </a>
                <form action="" method="post" onsubmit="return confirmDeleteForm(this)">
                  <input type="text" name="landbookMessage" placeholder="Enter a message to the user before deleting the buying form" required class="inputs">
                  <button type="submit" class="claimToCartButton">
                    Delete product
                  </button>
                </form>
                
              </div>
            
          </div>
        <% }) %>
      <% } else{ %>
        <div class="noProducts">No buying forms</div>
      <% } %>
    </div>


  <!-- footer container -->
  <footer>

    <div class="aboutThisPage">
      <div class="aboutThisPageLanguage">
        <div class="languageImage">
          <img src="/imagesAndVideos/Logos/About us icon.svg" alt="">
        </div>
        <div class="languageText">
          English
        </div>  
      </div>

      <div class="aboutCountry">
        <div class="aboutCountryImage">
          <img src="/imagesAndVideos/Logos/LOGO/Wow4.webp" alt="">
        </div>
        <div class="aboutCountryText">
          India
        </div>
      </div>
    </div>

    <div class="aboutCompany">
      <div class="companyConditions aboutCompanyTexts">
        Conditions of Use
      </div>
      <div class="companyPrivacyPolicy aboutCompanyTexts">
        Privacy Notice
      </div>
      <div class="aboutAdvertising aboutCompanyTexts">
        Interest-Based Ads
      </div>
    </div>

    <div class="companyCopywrite">
      .c. 1996-2024, Landbook.com, Inc. and its affiliates
    </div>

  </footer>

    

  <!-- <script type="module" src="./js/sell-page.js"></script> -->
   <script>
    function confirmDeleteForm() {
      const message = form.message.value.trim();
      if(!message) {
        alert('Please enter a message to the user before deleting the buying form of the user');
        return false;
      }
      return confirm('Are you sure you want to delete this product? This action cannot be undone!');
    }

    const timers = document.querySelectorAll('.timer');
    timers.forEach(timer => {
      const createdAt = new Date(timer.dataset.createdat);
      const endTime = new Date(createdAt.getTime() + 5 * 60 * 1000);
      const buyingCartTimerId = timer.dataset.formid;
      const progressBar = timer.nextElementSibling.querySelector('.progress');

      function updateTimer() {
        const now = new Date();
        const diff = endTime - now;
        const total = 5 * 60 * 1000;

        if(diff <= 0) {
          timer.textContent = 'Time Over';
          timer.classList.add('over');
          progressBar.style.width = '0%';

          // move automatically
          fetch(`/home/admin/modify-buying-products/${buyingCartTimerId}`, {
            method: 'POST'
          }).then(res => {
            if(res.ok) {
              console.log('Product moved to buying cart automatically!');
              location.reload();
            }
          });
        } else {
          const hours = Math.floor(diff / (1000 * 60 * 60));
          const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((diff % (1000 * 60)) / 1000);

          timer.textContent = `${hours}hr ${minutes}min ${seconds}sec`;

          // update progress bar
          const percentage = (diff / total) * 100;
          progressBar.style.width = `${percentage}`;
        }
      }

      setInterval(updateTimer, 1000);
      updateTimer();
    })

   </script>


</body>
</html>


<a href=""></a>